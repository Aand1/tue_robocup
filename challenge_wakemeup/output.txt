amigo@amigo3 $ rosrun challenge_wakemeup challenge_wakemeup.py amigo
[WARN] [WallTime: 1437213416.682568] Nav_analyser: Bagging = False
[INFO] [WallTime: 1437213416.685313] Waiting for the global planner services ...
[INFO] [WallTime: 1437213417.379139] Waiting for service /amigo/text_to_speech/speak
[INFO] [WallTime: 1437213417.385002] Initializing ebutton listener
[INFO] [WallTime: 1437213417.393723] Sys.argv = ['/home/amigo/ros/indigo/system/src/challenge_wakemeup/src/challenge_wakemeup.py', 'amigo'], Length = 2
/opt/ros/indigo/lib/python2.7/dist-packages/smach_ros/introspection.py:132: SyntaxWarning: The publisher should be created with an explicit keyword argument 'queue_size'. Please see http://wiki.ros.org/rospy/Overview/Publishers%20and%20Subscribers for more information.
  data_class=SmachContainerStructure)
/opt/ros/indigo/lib/python2.7/dist-packages/smach_ros/introspection.py:137: SyntaxWarning: The publisher should be created with an explicit keyword argument 'queue_size'. Please see http://wiki.ros.org/rospy/Overview/Publishers%20and%20Subscribers for more information.
  data_class=SmachContainerStatus)
[INFO] [WallTime: 1437213417.442563] State machine starting in initial state 'GET_NEWSPAPER' with userdata: 
    []
[INFO] [WallTime: 1437213417.442976] State machine starting in initial state 'POSE' with userdata: 
    []
[INFO] [WallTime: 1437213417.443288] LockingDesignator(<robot_smach_states.util.designators.designator.ArmDesignator object at 0x7f1b0a0e1a90>) resolved to <robot_ski, but is *not locked* to it
[INFO] [WallTime: 1437213420.263675] State machine transitioning 'POSE':'succeeded'-->'OPEN_BEFORE_INSERT'
[INFO] [WallTime: 1437213420.264177] LockingDesignator(<robot_smach_states.util.designators.designator.ArmDesignator object at 0x7f1b0a0e1a90>) resolved to <robot_ski, but is *not locked* to it
[INFO] [WallTime: 1437213424.371686] State machine transitioning 'OPEN_BEFORE_INSERT':'succeeded'-->'SAY1'
[INFO] [WallTime: 1437213424.372265] 'Please hand over the object by pushing it gently in my gripper'
[INFO] [WallTime: 1437213428.355662] State machine transitioning 'SAY1':'spoken'-->'CLOSE_AFTER_INSERT'
[INFO] [WallTime: 1437213428.356408] LockingDesignator(<robot_smach_states.util.designators.designator.ArmDesignator object at 0x7f1b0a0e1a90>) resolved to <robot_ski, but is *not locked* to it
[INFO] [WallTime: 1437213431.373437] State machine terminating 'CLOSE_AFTER_INSERT':'failed':'failed'
[INFO] [WallTime: 1437213431.373858] State machine transitioning 'GET_NEWSPAPER':'failed'-->'INITIALIZE'
[INFO] [WallTime: 1437213435.203980] TF link between /map and /base_link is checked. If it takes longer than a second, probably an error. Do a restart!!!
[INFO] [WallTime: 1437213436.393166] State machine transitioning 'INITIALIZE':'initialized'-->'START_CHALLENGE'
[INFO] [WallTime: 1437213436.393795] State machine starting in initial state 'INITIALIZE' with userdata: 
    []
[INFO] [WallTime: 1437213437.414316] TF link between /map and /base_link is checked. If it takes longer than a second, probably an error. Do a restart!!!
[INFO] [WallTime: 1437213437.417814] State machine transitioning 'INITIALIZE':'initialized'-->'INSTRUCT_WAIT_FOR_DOOR'
[INFO] [WallTime: 1437213437.418361] 'Hi there, I will now wait until the door is opened'
[INFO] [WallTime: 1437213437.420548] State machine transitioning 'INSTRUCT_WAIT_FOR_DOOR':'spoken'-->'WAIT_FOR_DOOR'
[INFO] [WallTime: 1437213437.420952] Waiting for door...
[INFO] [WallTime: 1437213445.898426] Distance to door is more than a meter
[INFO] [WallTime: 1437213445.898947] Distance to door is more than a meter
[INFO] [WallTime: 1437213445.903440] Unregistering laser listener and clearing data
[INFO] [WallTime: 1437213445.906518] Door is open
[INFO] [WallTime: 1437213445.906836] State machine transitioning 'WAIT_FOR_DOOR':'open'-->'DOOR_OPEN'
[INFO] [WallTime: 1437213445.907331] 'Door is open!'
[INFO] [WallTime: 1437213445.910516] State machine transitioning 'DOOR_OPEN':'spoken'-->'INIT_POSE'
id: initial_pose_door_A
type: waypoint
existence_probability: 1.0
last_update_time: 
  secs: 0
  nsecs: 0
creation_time: 
  secs: 0
  nsecs: 0
has_shape: False
has_pose: True
pose: 
  position: 
    x: 0.0
    y: -6.15
    z: 0.0
  orientation: 
    x: 0.0
    y: 0.0
    z: 0.0
    w: 1.0
data: {'color': {'blue': 0, 'green': 0, 'red': 1}, 'pose': {'y': -6.15, 'x': 0, 'z': 0, 'rz': 0}, 'type': 'waypoint', 'id': 'initial_pose_door_A', 'affordances': {'navigate-to': {'position_constraint': {'constraint': 'x^2 + y^2 < 0.5^2'}}}}
flags: []
convex_hull: []
z_min: 0.0
z_max: 0.0
[INFO] [WallTime: 1437213445.919267] Set initial pose to 0.0, -6.15, 0
[INFO] [WallTime: 1437213446.420229] State machine transitioning 'INIT_POSE':'done'-->'ENTER_ROOM'
[INFO] [WallTime: 1437213446.420803] State machine starting in initial state 'THROUGH_DOOR' with userdata: 
    []
[INFO] [WallTime: 1437213446.421208] 'I will start my task now'
[INFO] [WallTime: 1437213446.423890] State machine transitioning 'THROUGH_DOOR':'spoken'-->'FORCE_DRIVE_THROUGH_DOOR'
[INFO] [WallTime: 1437213446.424319] AMIGO uses force drive as a back-up scenario!
[ERROR] [WallTime: 1437213446.424623] Called get_state when no goal is running
[INFO] [WallTime: 1437213452.447663] State machine transitioning 'FORCE_DRIVE_THROUGH_DOOR':'done'-->'GO_TO_ENTRY_POINT'
TODO: IMPLEMENT THIS STATE
[INFO] [WallTime: 1437213452.448262] State machine terminating 'GO_TO_ENTRY_POINT':'no_goal':'done'
[INFO] [WallTime: 1437213452.448559] State machine terminating 'ENTER_ROOM':'done':'Done'
[INFO] [WallTime: 1437213452.448854] State machine transitioning 'START_CHALLENGE':'Done'-->'SAY_OPERATOR_AWAKE'
[INFO] [WallTime: 1437213452.449303] 'Lets see if my operator is awake'
[INFO] [WallTime: 1437213452.452263] State machine transitioning 'SAY_OPERATOR_AWAKE':'spoken'-->'GO_TO_BED'
[INFO] [WallTime: 1437213452.452718] State machine starting in initial state 'START_ANALYSIS' with userdata: 
    []
[INFO] [WallTime: 1437213452.455784] State machine transitioning 'START_ANALYSIS':'done'-->'NAVIGATE'
[INFO] [WallTime: 1437213452.456209] State machine starting in initial state 'GET_PLAN' with userdata: 
    []
[INFO] [WallTime: 1437213452.572093] choosing best entity from this list (name->weight):
    [('bed', 0)]
[INFO] [WallTime: 1437213452.581288] choosing best entity from this list (name->weight):
    [('bed', 0)]
[INFO] [WallTime: 1437213452.588502] choosing best entity from this list (name->weight):
    [('bedroom', 0)]
[INFO] [WallTime: 1437213452.655840] choosing best entity from this list (name->weight):
    [('bed', 0)]
[INFO] [WallTime: 1437213452.680343] Goal handle = <actionlib.action_client.ClientGoalHandle instance at 0x7f1b09fe7ab8>
[INFO] [WallTime: 1437213452.680785] 'I'm on my way!'
[INFO] [WallTime: 1437213452.683821] State machine transitioning 'GET_PLAN':'goal_ok'-->'EXECUTE_PLAN'
[INFO] [WallTime: 1437213471.704286] State machine terminating 'EXECUTE_PLAN':'succeeded':'arrived'
[INFO] [WallTime: 1437213471.704730] State machine transitioning 'NAVIGATE':'arrived'-->'STOP_ANALYSIS_SUCCEED'
[INFO] [WallTime: 1437213471.710680] 

Navigation summary:
Covered 8.58761966857 meters in 19.2547380924 seconds (0.446000336507) m/s avg.
Result = succeeded with 0 plans, 0 clears and 0 resets


[INFO] [WallTime: 1437213471.711052] State machine terminating 'STOP_ANALYSIS_SUCCEED':'done':'arrived'
[INFO] [WallTime: 1437213471.711342] State machine transitioning 'GO_TO_BED':'arrived'-->'WAKEUP_CONTAINER'
[INFO] [WallTime: 1437213471.711744] State machine starting in initial state 'CANCEL_HEAD_GOALS' with userdata: 
    []
[WAKE ME UP] CancelHeadGoals
[INFO] [WallTime: 1437213471.712110] State machine transitioning 'CANCEL_HEAD_GOALS':'done'-->'LOOK_AT_BED'
[WAKE ME UP] LookAtBedTop
Waiting for 4 seconds to reach target ...
[INFO] [WallTime: 1437213472.714861] State machine transitioning 'LOOK_AT_BED':'succeeded'-->'SET_TIME_MARKER'
[INFO] [WallTime: 1437213472.715525] State machine transitioning 'SET_TIME_MARKER':'done'-->'WAKEUP_MESSAGE'
[INFO] [WallTime: 1437213472.715986] 'Wake up boss'
[INFO] [WallTime: 1437213473.989143] State machine transitioning 'WAKEUP_MESSAGE':'spoken'-->'LOOK_IF_AWAKE'
[INFO] [WallTime: 1437213474.010498] Criterium         def is_large_enough(entity):
            if len(entity.convex_hull) < 3:
                return False

            chull = [entity.convex_hull[-1]] + entity.convex_hull + [entity.convex_hull[0]]
            area = 0
            for ppt, pt, npt in zip(chull, chull[1:], chull[2:]):
                area += pt.x*( npt.y - ppt.y );
            area /= 2

            return area > knowledge.find_person['min_chull_area']
 leaves 8 entities
[INFO] [WallTime: 1437213474.011203] Criterium         def probably_exists(entity):
            return entity.existence_probability > knowledge.find_person['min_exist_prob']
 leaves 7 entities
[INFO] [WallTime: 1437213474.097359] Criterium         def is_just_above_bed(entity):
            bed = robot.ed.get_entity(knowledge.bed)

            # Check if z coordinate is within specified range
            if entity.pose.position.z + entity.z_max < bed.pose.position.z + bed.z_max + knowledge.find_person['under_z']:
                return False

            # Check if center point of entity is within chull of bed
            bed_chull = bed.convex_hull
            bed_chull = bed_chull + [bed_chull[0]]

            for i in range(len(bed_chull)-1):
                dx = bed_chull[i+1].x - bed_chull[i].x
                dy = bed_chull[i+1].y - bed_chull[i].y

                dxe = -bed_chull[i].x
                dye = -bed_chull[i].y

                # Cross product of these two gives either positive or negative, if one is negative, point is outside the chull
                if dx*dye-dy*dxe < 0:
                    return False

            return True
 leaves 1 entities
[INFO] [WallTime: 1437213474.097942] Criterium         def is_not_bed(entity):
            return entity.id != knowledge.bed
 leaves 1 entities
[INFO] [WallTime: 1437213474.098321] Criterium         def is_not_prior(entity):
            return entity.type == '' or entity.type == 'human'
 leaves 1 entities
[INFO] [WallTime: 1437213474.098624] choosing best entity from this list (name->weight):
    [('d4cdd170f90b02e2226a7d09c629d50a', 0)]
[INFO] [WallTime: 1437213474.164677] State machine transitioning 'LOOK_IF_AWAKE':'there'-->'SAY_AWAKE'
[INFO] [WallTime: 1437213474.165347] 'Finally, you're awake, I will hand you your newspaper now'
[INFO] [WallTime: 1437213478.264835] State machine transitioning 'SAY_AWAKE':'spoken'-->'HANDOVER_NEWSPAPER'
[INFO] [WallTime: 1437213478.265493] State machine starting in initial state 'LOCK_ARM' with userdata: 
    []
[INFO] [WallTime: 1437213478.265769] LockingDesignator(<robot_smach_states.util.designators.designator.ArmDesignator object at 0x7f1b0a0e1a90>) resolved to <robot_ski, but is *not locked* to it
[INFO] [WallTime: 1437213478.265993] LockingDesignator(LockingDesignator(<robot_smach_states.util.designators.designator.ArmDesignator object at 0x7f1b0a0e1a90>)) locked to <robot_ski
[INFO] [WallTime: 1437213478.266262] locking_designator LockingDesignator(LockingDesignator(<robot_smach_states.util.designators.designator.ArmDesignator object at 0x7f1b0a0e1a90>)) is now locked to <robot_ski
[INFO] [WallTime: 1437213478.266479] State machine transitioning 'LOCK_ARM':'locked'-->'SPINDLE_MEDIUM'
[INFO] [WallTime: 1437213478.267016] State machine transitioning 'SPINDLE_MEDIUM':'done'-->'MOVE_HUMAN_HANDOVER_JOINT_GOAL'
[INFO] [WallTime: 1437213481.088298] State machine transitioning 'MOVE_HUMAN_HANDOVER_JOINT_GOAL':'succeeded'-->'SAY_OPEN_GRIPPER'
[INFO] [WallTime: 1437213481.088914] 'I will open my gripper when you slightly pull this thing'
[INFO] [WallTime: 1437213484.545556] State machine transitioning 'SAY_OPEN_GRIPPER':'spoken'-->'OPEN_GRIPPER_ON_HANDOVER'
[INFO] [WallTime: 1437213514.555993] State machine transitioning 'OPEN_GRIPPER_ON_HANDOVER':'failed'-->'SAY_I_WILL_KEEP_IT'
[INFO] [WallTime: 1437213514.556564] 'If you don't want it, I will keep it'
[INFO] [WallTime: 1437213517.118373] State machine transitioning 'SAY_I_WILL_KEEP_IT':'spoken'-->'RESET_ARM'
[INFO] [WallTime: 1437213519.933851] State machine transitioning 'RESET_ARM':'succeeded'-->'RESET_TORSO'
[INFO] [WallTime: 1437213519.934679] State machine transitioning 'RESET_TORSO':'done'-->'UNLOCK_ARM'
[INFO] [WallTime: 1437213519.935094] locking_designator LockingDesignator(LockingDesignator(<robot_smach_states.util.designators.designator.ArmDesignator object at 0x7f1b0a0e1a90>)) is going to unlock from <robot_ski
[INFO] [WallTime: 1437213519.935373] State machine terminating 'UNLOCK_ARM':'unlocked':'succeeded'
[INFO] [WallTime: 1437213519.935657] State machine terminating 'HANDOVER_NEWSPAPER':'succeeded':'container_succeeded'
[INFO] [WallTime: 1437213519.935927] State machine transitioning 'WAKEUP_CONTAINER':'container_succeeded'-->'CANCEL_HEAD_GOALS_1'
[WAKE ME UP] CancelHeadGoals
[INFO] [WallTime: 1437213519.936398] State machine transitioning 'CANCEL_HEAD_GOALS_1':'done'-->'TAKE_ORDER_CONTAINER'
[INFO] [WallTime: 1437213519.936830] State machine starting in initial state 'SET_TIME_MARKER' with userdata: 
    []
[INFO] [WallTime: 1437213519.937438] State machine transitioning 'SET_TIME_MARKER':'done'-->'SAY_WHAT_BREAKFAST'
[INFO] [WallTime: 1437213519.938365] 'What do you want to eat?'
[INFO] [WallTime: 1437213521.470904] State machine transitioning 'SAY_WHAT_BREAKFAST':'spoken'-->'GET_ORDER'
[WAKE ME UP] GetOrder
[INFO] [WallTime: 1437213541.747321] State machine transitioning 'GET_ORDER':'failed'-->'SAY_INCORRECT_ORDER'
[INFO] [WallTime: 1437213541.747957] 'I didn't get that.'
[INFO] [WallTime: 1437213541.750618] State machine transitioning 'SAY_INCORRECT_ORDER':'spoken'-->'CHECK_TIME'
[INFO] [WallTime: 1437213541.751022] State machine transitioning 'CHECK_TIME':'ok'-->'SAY_WHAT_BREAKFAST'
[INFO] [WallTime: 1437213541.751452] 'Please tell me your breakfast order.'
[INFO] [WallTime: 1437213545.514427] State machine transitioning 'SAY_WHAT_BREAKFAST':'spoken'-->'GET_ORDER'
[WAKE ME UP] GetOrder
[INFO] [WallTime: 1437213565.660913] State machine transitioning 'GET_ORDER':'failed'-->'SAY_INCORRECT_ORDER'
[INFO] [WallTime: 1437213565.661648] 'I missunderstood something,'
[INFO] [WallTime: 1437213565.664473] State machine transitioning 'SAY_INCORRECT_ORDER':'spoken'-->'CHECK_TIME'
[INFO] [WallTime: 1437213565.664971] State machine transitioning 'CHECK_TIME':'ok'-->'SAY_WHAT_BREAKFAST'
[INFO] [WallTime: 1437213565.665419] 'What would you like to have for breakfast?'
[INFO] [WallTime: 1437213569.911914] State machine transitioning 'SAY_WHAT_BREAKFAST':'spoken'-->'GET_ORDER'
[WAKE ME UP] GetOrder
[INFO] [WallTime: 1437213589.967283] State machine transitioning 'GET_ORDER':'failed'-->'SAY_INCORRECT_ORDER'
[INFO] [WallTime: 1437213589.967879] 'I missunderstood something,'
[INFO] [WallTime: 1437213589.970548] State machine transitioning 'SAY_INCORRECT_ORDER':'spoken'-->'CHECK_TIME'
[INFO] [WallTime: 1437213589.971192] State machine terminating 'CHECK_TIME':'timeout':'container_failed'
[INFO] [WallTime: 1437213589.971492] State machine transitioning 'TAKE_ORDER_CONTAINER':'container_failed'-->'SAY_ILL_CHOOSE_BREAKFAST'
[INFO] [WallTime: 1437213589.971990] 'I couldn't understand the breakfast order. I'll choose something for you.'
[INFO] [WallTime: 1437213589.974104] State machine transitioning 'SAY_ILL_CHOOSE_BREAKFAST':'spoken'-->'GOTO_KITCHEN_CONTAINER'
[INFO] [WallTime: 1437213589.974570] State machine starting in initial state 'SAY_PREPARING' with userdata: 
    []
[INFO] [WallTime: 1437213589.974970] 'I'm going to the kitchen'
[INFO] [WallTime: 1437213589.977504] State machine transitioning 'SAY_PREPARING':'spoken'-->'GOTO_KITCHEN'
[INFO] [WallTime: 1437213589.978062] State machine starting in initial state 'START_ANALYSIS' with userdata: 
    []
[INFO] [WallTime: 1437213589.981096] State machine transitioning 'START_ANALYSIS':'done'-->'NAVIGATE'
[INFO] [WallTime: 1437213589.981620] State machine starting in initial state 'GET_PLAN' with userdata: 
    []
[INFO] [WallTime: 1437213590.096282] choosing best entity from this list (name->weight):
    [('kitchen', 0)]
[INFO] [WallTime: 1437213590.148317] choosing best entity from this list (name->weight):
    [('kitchen', 0)]
[INFO] [WallTime: 1437213590.173385] Goal handle = <actionlib.action_client.ClientGoalHandle instance at 0x7f1b09f85bd8>
[INFO] [WallTime: 1437213590.173831] 'I will go there right away!'
[INFO] [WallTime: 1437213590.176922] State machine transitioning 'GET_PLAN':'goal_ok'-->'EXECUTE_PLAN'
[INFO] [WallTime: 1437213614.200940] State machine terminating 'EXECUTE_PLAN':'succeeded':'arrived'
[INFO] [WallTime: 1437213614.201612] State machine transitioning 'NAVIGATE':'arrived'-->'STOP_ANALYSIS_SUCCEED'
[INFO] [WallTime: 1437213614.205805] 

Navigation summary:
Covered 10.1777523556 meters in 24.2245969772 seconds (0.420141245907) m/s avg.
Result = succeeded with 0 plans, 0 clears and 0 resets


[INFO] [WallTime: 1437213614.206161] State machine terminating 'STOP_ANALYSIS_SUCCEED':'done':'arrived'
[INFO] [WallTime: 1437213614.206459] State machine terminating 'GOTO_KITCHEN':'arrived':'container_succeeded'
[INFO] [WallTime: 1437213614.206722] State machine transitioning 'GOTO_KITCHEN_CONTAINER':'container_succeeded'-->'PREP_BREAKFAST_CONTAINER'
[INFO] [WallTime: 1437213614.207187] State machine starting in initial state 'SAY_PREPARING' with userdata: 
    []
[INFO] [WallTime: 1437213614.207517] 'I'm going to prepare your breakfast. La la la la la'
[INFO] [WallTime: 1437213614.210293] State machine transitioning 'SAY_PREPARING':'spoken'-->'SELECT_ITEM'
[ERROR] [WallTime: 1437213614.215377] InvalidUserCodeError: Could not execute state 'SELECT_ITEM' of type '<wakemeup_states.SelectItem object at 0x7f1b0a0fc7d0>': Traceback (most recent call last):
  File "/opt/ros/indigo/lib/python2.7/dist-packages/smach/state_machine.py", line 247, in _update_once
    self._remappings[self._current_label]))
  File "/home/amigo/ros/indigo/repos/https:/github.com/tue-robotics/tue_robocup.git/challenge_wakemeup/src/wakemeup_states.py", line 429, in execute
    self.specific_item.current = list(set(category_items).intersection(asked_items))[0]
IndexError: list index out of range

[ERROR] [WallTime: 1437213614.215712] State 'PREP_BREAKFAST_CONTAINER' failed to execute.
Exception occurred on state machine execution

