<?xml version="1.0"?>

<launch>

<arg name="setting" default="$(optenv PERCEPTION_SETTING robotics_testlab_B)"/>

<node pkg="pein_tabletop_segmentation" type="pein_tabletop_segmentation" name="pein_tabletop_segmentation_external" output="screen">
	<remap from="/amigo/top_kinect/driver/set_parameters" to="/external/top_kinect/driver/set_parameters"/>
	<remap from="/amigo/top_kinect/depth_registered/camera_info" to="/external/top_kinect/depth_registered/camera_info"/>
	<remap from="/amigo/top_kinect/depth_registered/image_rect" to="/external/top_kinect/depth_registered/image_rect"/>
	<remap from="/amigo/top_kinect/rgb/image_color" to="/external/top_kinect/rgb/image_color"/>

	<remap from="/tabletop_rois" to="/external/tabletop_rois"/>
	<remap from="/vis_clusters" to="/external/vis_clusters"/>
	<remap from="/vis_plane" to="/external/vis_plane"/>
	<remap from="/vis_tabletop_roi" to="/external/vis_tabletop_roi"/>
	<remap from="/object_segmentation/srv_input" to="/external/object_segmentation/srv_input"/>
	<remap from="/tabletop_segmentation/srv_input" to="/external/tabletop_segmentation/srv_input"/>
	<remap from="/table_detection/srv_input" to="/external/table_detection/srv_input"/>
	<remap from="/object_segmentation/roi_srv_input" to="/external/object_segmentation/roi_srv_input"/>
	<remap from="/tabletop_segmentation/roi_srv_input" to="/external/tabletop_segmentation/roi_srv_input"/>

	<param name="service_name" value="input_service"/>
	<param name="input_tf" type="string" value="/map"/>
	<param name="wait_time_table_transform" type="double" value="1.0"/>
	<param name="min_table_height" type="double" value="0.3"/>
	<param name="max_table_height" type="double" value="1.5"/>
	<param name="vis_pcls" type="bool" value="true"/>
</node>

<node pkg="pein_pcl_matcher" type="pein_pcl_matcher" name="pein_pcl_matcher_external" output="screen">
	<param name="input_topic" value="/external/tabletop_rois"/>
	<param name="output_topic" value="/external/pcl_matcher/output"/>
	<param name="debug_mode" type="bool" value="false"/>

	<!-- Loading the correct model set -->
	<param name="setting" value="$(arg setting)"/>
</node>

<node pkg="pein_color_matcher" type="pein_color_matcher" name="pein_color_matcher_external" output="screen">
	<remap from="~input" to="/external/pcl_matcher/output"/>
	<remap from="~output" to="/external/color_matcher/output"/>
	<param name="debug_mode" type="bool" value="false"/>
</node>

<!-- Object detector -->
<node  pkg="pein_odufinder" type="odu_finder_node" name="odu_finder" output="screen">
	<!-- Location images -->
	<param  name="images_folder" type="string" value="$(arg setting)" />

	<param  name="command" type="string" value="/load" />
	<param  name="database_location" type="string" value="$(find pein_odufinder)/database" />
	<param  name="image_topic" type="string" value="/external/tabletop_rois" />
	<param  name="images_for_visualization_directory" type="string" value="$(find pein_odufinder)/image_data" />

	<param  name="pein_input_topic" type="string" value="/external/color_matcher/output" />
	<param  name="pein_output_topic" type="string" value="/external/odu_finder/output" />
	<param  name="template_topic" type="string" value="found_template" />

	<param  name="enable_visualization" type="int" value="1" />

	<!-- No results if switched off -->
	<param  name="enable_clustering" type="int" value="1" />

	<!-- Optional Parametes -->
	<param  name="votes_count" type="int" value="10" />
	<param  name="object_threshold" type="double" value="0.22" />
</node>

</launch>
